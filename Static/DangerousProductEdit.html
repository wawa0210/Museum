<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>湖南省博物馆后台管理系统</title>

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="/css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="/css/plugins/steps/jquery.steps.css" rel="stylesheet">
    <link href="/css/animate.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">


    <style>

        .wizard > .content > .body { position: relative; }
        .sel_Disable{
        }
    </style>

</head>

<body style="background-color: #fdfeff;">
    <div id="wrapper">
        <div>
           <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>危险源信息编辑</small></h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                            </div>
                        </div>
                        <div class="ibox-content">
                            <form class="form-horizontal" id="form_DangerousProduct">
                                <div class="form-group"><label class="col-sm-2 control-label">登记号</label>
                                    <div class="col-sm-4"><input type="text" id="ip_regesterId" class="form-control"></div>
                                </div>
                                <div class="form-group"><label class="col-sm-2 control-label">危险源名称</label>
                                    <div class="col-sm-4"><input type="text" id="ip_productName" name="productName" class="form-control" required></div>
                                </div>
                                <div class="form-group"><label class="col-sm-2 control-label">别名</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" id="ip_aliasName">
                                    </div>
                                </div>
                                <div class="form-group"><label class="col-sm-2 control-label">属性</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" id="ip_productAttributes">
                                    </div>
                                </div>
                                <div class="form-group"><label class="col-sm-2 control-label">生产能力</label>
                                    <div class="col-sm-4">
                                        <div class="input-group m-b">
                                            <input type="text" class="form-control" name="manufacturability" id="ip_manufacturability">
                                            <span class="input-group-addon">吨</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group"><label class="col-sm-2 control-label">最大储量</label>
                                    <div class="col-sm-4">
                                        <div class="input-group m-b">
                                            <input type="text" class="form-control" name="productReserve" id="ip_productReserve">
                                            <span class="input-group-addon">吨</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group"><label class="col-sm-2 control-label">年生产量</label>
                                    <div class="col-sm-4">
                                        <div class="input-group m-b">
                                            <input type="text" class="form-control" id="ip_yearProduct" name="yearProduct">
                                            <span class="input-group-addon">吨</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group"><label class="col-sm-2 control-label">CAS</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" id="ip_cas">
                                    </div>
                                </div>
                                <div class="form-group"><label class="col-sm-2 control-label">UN</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" id="ip_un">
                                    </div>
                                </div>
                                <div class="form-group"><label class="col-sm-2 control-label">剧毒</label>
                                   <div class="col-sm-4">
                                        <select id="sel_isToxicity" class="form-control">
                                          <option value="1" selected="selected">是</option>
                                          <option value="0">否</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group"><label class="col-sm-2 control-label">安全技术说明书</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" id="ip_instructions">
                                    </div>
                                </div>
                                <div class="form-group"><label class="col-sm-2 control-label">专家意见</label>
                                    <div class="col-sm-4">
                                        <textarea class="form-control" id="ip_expertOpinion"> </textarea>
                                    </div>
                                </div>
                                 <div class="form-group"><label class="col-sm-2 control-label">管控预案措施</label>
                                    <div class="col-sm-4">
                                        <textarea class="form-control" id="ip_managementPlan"> </textarea>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>
                            </form>
                            <div class="col-sm-4 col-sm-offset-2">
                                <button class="btn btn-default" id="btn_Cancel" onclick="Cancel()">取消</button>
                                <button onclick="SaveDangerousProductInfo()"  class="btn btn-primary" id="btn_Save">保存</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <input type="hidden"  id="hid_actionType" value="0" />
    <input type="hidden"  id="hid_companyId" value="0" />
    <input type="hidden"  id="hid_dangerousId" value="0" />
    <!-- Mainly scripts -->
    <script src="/js/jquery-2.1.1.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="/js/inspinia.js"></script>
    <script src="/js/plugins/pace/pace.min.js"></script>

    <!-- Steps -->
    <script src="/js/plugins/staps/jquery.steps.min.js"></script>

    <!-- Jquery Validate -->
    <script src="/js/plugins/validate/jquery.validate.min.js"></script>
    <script src="/js/common.js"></script>

    <script>
        var companyId="";
        var validator;
        $(document).ready(function(){
            //判断新增or编辑
            var actionType=getUrlParam("actionType");
            companyId = getUrlParam("companyId");
            $("#hid_companyId").val(companyId);
            if(actionType=="add"){
                $("#hid_actionType").val("0");
            }
            else{
                var dangerousId = getUrlParam("dangerousId");
                if(dangerousId!=null && dangerousId!="")
                {
                    LoadDangerousProductInfo(companyId,dangerousId);
                }
                $("#hid_dangerousId").val(dangerousId);
                $("#hid_actionType").val("1");
            }

            validator = $("#form_DangerousProduct").validate({  
                rules: {  
                    productName: { required: true},
                    manufacturability: { required: true},
                    productReserve: { required: true},
                    yearProduct: { required: true}
                },  
                messages: {  
                    productName: {  
                        required: "危险源名称不能为空"
                    },
                    manufacturability: {  
                        required: "生产能力不能为空"
                    } ,
                    productReserve: {  
                        required: "最大储量不能为空"
                    } ,
                    yearProduct: {  
                        required: "年生产量不能为空"
                    } 
                }  
            }); 

       });

        function Cancel(){
            $("#iframe_DashBoard",parent.document).attr('src',"/Static/DangerousProductList.html?companyId="+companyId);
        }

        function SaveDangerousProductInfo(){

            var formInfo = $("#form_DangerousProduct");
            // Disable validation on fields that are disabled or hidden.
            formInfo.validate().settings.ignore = ":disabled,:hidden";
            // Start validation; Prevent going forward if false
            if(!formInfo.valid()){
                validator.focusInvalid();
                return false;
            }

            var dangerousproduct ={};
                dangerousproduct.id = $("#hid_dangerousId").val();
                dangerousproduct.regesterId = $("#ip_regesterId").val();
                dangerousproduct.companyId = $("#hid_companyId").val();
                dangerousproduct.productName = $("#ip_productName").val();
                dangerousproduct.aliasName = $("#ip_aliasName").val();
                dangerousproduct.productAttributes = $("#ip_productAttributes").val();
                dangerousproduct.manufacturability = $("#ip_manufacturability").val();
                dangerousproduct.productReserve = $("#ip_productReserve").val();
                dangerousproduct.yearProduct = $("#ip_yearProduct").val();
                dangerousproduct.cas = $("#ip_cas").val();
                dangerousproduct.un = $("#ip_un").val();
                dangerousproduct.isToxicity = $("#sel_isToxicity").val();
                dangerousproduct.instructions = $("#ip_instructions").val();
                dangerousproduct.expertOpinion = $("#ip_expertOpinion").val();
                dangerousproduct.managementPlan = $("#ip_managementPlan").val();
              
                DangerousProductInfo(dangerousproduct,function(result){
                   if(result.code=="0"){
                      alert("保存成功");
                      Cancel();
                   }
                   else{
                    alert("保存失败");
                   }
                });
        }

        function DangerousProductInfo(params,callback){
            var uri = '/dangerousproducts';
            params = JSON.stringify(params);
            if($("#hid_actionType").val()=="0"){
                doPost(uri,params,function(res){
                   if (callback) {
                          callback(res);
                      }
                },"json");
            }
            else{
                //编辑
                doPut(uri,params,function(res){
                   if (callback) {
                          callback(res);
                      }
                },"json");
            }
        }

        //加载公司信息
        function LoadDangerousProductInfo(companyId,dangerousId){
            GetDangerousProductInfo(dangerousId,function(result){
                if(result.code=="0"){
                    var dangerousproduct = result.data;
                    $("#ip_regesterId").val(dangerousproduct.regesterId);
                    $("#ip_companyId").val(dangerousproduct.companyId);
                    $("#ip_productName").val(dangerousproduct.productName);
                    $("#ip_aliasName").val(dangerousproduct.aliasName);
                    $("#ip_productAttributes").val(dangerousproduct.productAttributes);
                    $("#ip_manufacturability").val(dangerousproduct.manufacturability);
                    $("#ip_productReserve").val(dangerousproduct.productReserve);
                    $("#ip_yearProduct").val(dangerousproduct.yearProduct);
                    $("#ip_cas").val(dangerousproduct.cas);
                    $("#ip_un").val(dangerousproduct.un);
                    $("#sel_isToxicity").val(dangerousproduct.isToxicity);
                    $("#ip_instructions").val(dangerousproduct.instructions);
                    $("#ip_expertOpinion").val(dangerousproduct.expertOpinion);
                    $("#ip_managementPlan").val(dangerousproduct.managementPlan);
                }
            });
        }

        function GetDangerousProductInfo(dangerousId,callback){
            var uri = '/dangerousproducts/'+dangerousId;
            doGet(uri,function(res){
                if (callback) {
                    callback(res);
                }
            });
        }
    </script>

</body>

</html>
